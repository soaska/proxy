version: '3.8'

services:
  proxy:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: telegram-socks-proxy
    ports:
      - "6666:6666/tcp"
      - "6666:6666/udp"
      #- "8080:8080/tcp"  # API port
    restart: unless-stopped
    environment:
      - TZ=Europe/Moscow
      
      # SOCKS5 Configuration
      - LISTEN=:6666
      #- SUBNET=fe80::
      - SUBNET_MASK=64
      - REFRESH_INTERVAL=1m
      
      # Statistics
      - STATS_ENABLED=true
      - STATS_DATABASE_PATH=/root/data/stats.db
      - STATS_GEOIP_PATH=/root/data/GeoLite2-City.mmdb
      - STATS_RETENTION_DAYS=90
      
      # API Configuration
      - API_ENABLED=true
      - API_LISTEN=:8080
      - API_KEY=${API_KEY:-your-secret-api-key-change-this}
      
      # Telegram Bot
      #- TELEGRAM_ENABLED=${TELEGRAM_ENABLED:-false}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      
    volumes:
      - data:/root/data  # Persistent storage for database and GeoIP
      #- ./config.yml:/root/config.yml:ro  # Optional: mount custom config
    networks:
      - proxy-network
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "6666"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
volumes:
  data:
